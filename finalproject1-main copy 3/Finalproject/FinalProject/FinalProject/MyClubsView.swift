//
//  MyClubsView.swift
//  FinalProject
//
//  Created by Ahmet Aytac on 11/10/25.
//


import SwiftUIstruct MyClubsView: View {    @StateObject private var viewModel = MyClubsViewModel()        var body: some View {        NavigationView {            ScrollView {                VStack(spacing: 0) {                    if viewModel.isLoading {                        ProgressView()                            .padding(.top, 100)                    } else if viewModel.myClubs.isEmpty {                        VStack(spacing: 20) {                            Image(systemName: "person.3.fill")                                .font(.system(size: 60))                                .foregroundColor(.gray)                                                        Text("No Clubs Yet")                                .font(.system(size: 24, weight: .bold))                                                        Text("Join clubs from the Explore tab to see them here")                                .font(.system(size: 14))                                .foregroundColor(.gray)                                .multilineTextAlignment(.center)                                .padding(.horizontal, 60)                        }                        .padding(.top, 120)                    } else {                        LazyVStack(spacing: 0) {                            ForEach(viewModel.myClubs) { club in                                NavigationLink(destination: ClubDetailView(club: club)) {                                    MyClubCard(club: club, userRole: viewModel.getRoleForClub(club))                                }                                .buttonStyle(PlainButtonStyle())                                                                Divider()                                    .padding(.leading, 90)                            }                        }                        .padding(.top, 8)                    }                }            }            .navigationTitle("My Clubs")            .refreshable {                viewModel.loadMyClubs()            }        }        .onAppear {            viewModel.loadMyClubs()        }    }}struct MyClubCard: View {    let club: Club    let userRole: String?        var body: some View {        HStack(spacing: 16) {            // Club Icon            RoundedRectangle(cornerRadius: 12)                .fill(Color.black)                .frame(width: 64, height: 64)                .overlay(                    Text(club.name?.prefix(1).uppercased() ?? "C")                        .font(.system(size: 28, weight: .bold))                        .foregroundColor(.white)                )                        // Club Info            VStack(alignment: .leading, spacing: 6) {                HStack(spacing: 8) {                    Text(club.name ?? "Club")                        .font(.system(size: 18, weight: .semibold))                        .foregroundColor(.black)                                        // Role Badge                    if let role = userRole, role != "member" {                        Text(role.uppercased())                            .font(.system(size: 10, weight: .bold))                            .foregroundColor(.white)                            .padding(.horizontal, 6)                            .padding(.vertical, 3)                            .background(roleColor(for: role))                            .cornerRadius(6)                    }                }                                if let description = club.description, !description.isEmpty {                    Text(description)                        .font(.system(size: 14))                        .foregroundColor(.gray)                        .lineLimit(2)                }                                HStack(spacing: 12) {                    if let category = club.category {                        HStack(spacing: 4) {                            Image(systemName: "tag.fill")                                .font(.system(size: 10))                            Text(category)                        }                        .font(.system(size: 12))                        .foregroundColor(.gray)                    }                                        HStack(spacing: 4) {                        Image(systemName: "person.2.fill")                            .font(.system(size: 10))                        Text("\(club.memberCount ?? 0)")                    }                    .font(.system(size: 12))                    .foregroundColor(.gray)                }            }                        Spacer()                        Image(systemName: "chevron.right")                .foregroundColor(.gray)                .font(.system(size: 14))        }        .padding(.horizontal)        .padding(.vertical, 12)    }        func roleColor(for role: String) -> Color {        switch role {        case "admin":            return .red        case "leader":            return .orange        case "moderator":            return .blue        default:            return .gray        }    }}class MyClubsViewModel: ObservableObject {    @Published var myClubs: [Club] = []    @Published var clubRoles: [String: String] = [:]  // clubId: role    @Published var isLoading = false        func loadMyClubs() {        guard let userId = User.current?.objectId else { return }                isLoading = true                Task {            do {                let clubs = try await ParseService.shared.getUserClubs(userId: userId)                                // Load roles for each club                var roles: [String: String] = [:]                for club in clubs {                    if let clubId = club.objectId {                        let role = try? await ParseService.shared.getUserRoleInClub(userId: userId, clubId: clubId)                        roles[clubId] = role                    }                }                                await MainActor.run {                    self.myClubs = clubs                    self.clubRoles = roles                    self.isLoading = false                }            } catch {                await MainActor.run {                    self.isLoading = false                    print("Error loading my clubs: \(error)")                }            }        }    }        func getRoleForClub(_ club: Club) -> String? {        guard let clubId = club.objectId else { return nil }        return clubRoles[clubId]    }}#Preview {    MyClubsView()}