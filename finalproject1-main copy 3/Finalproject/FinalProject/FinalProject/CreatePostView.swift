////  CreatePostView.swift//  FinalProject////  Created by Ahmet Aytac on 11/9/25.//import SwiftUIimport PhotosUIstruct CreatePostView: View {    @Environment(\.dismiss) var dismiss    @StateObject private var viewModel = CreatePostViewModel()        var body: some View {        NavigationView {            ScrollView {                VStack(spacing: 20) {                    // Image Picker                    if let image = viewModel.selectedImage {                        Image(uiImage: image)                            .resizable()                            .scaledToFit()                            .frame(maxHeight: 400)                            .cornerRadius(12)                    } else {                        Button(action: {                            viewModel.showImagePicker = true                        }) {                            VStack(spacing: 16) {                                Image(systemName: "photo.on.rectangle.angled")                                    .font(.system(size: 60))                                    .foregroundColor(.gray)                                                                Text("Select Photo")                                    .font(.system(size: 18, weight: .semibold))                                    .foregroundColor(.black)                            }                            .frame(maxWidth: .infinity)                            .frame(height: 300)                            .background(Color.gray.opacity(0.1))                            .cornerRadius(12)                        }                    }                                        // Caption Input                    VStack(alignment: .leading, spacing: 8) {                        Text("Caption")                            .font(.system(size: 16, weight: .semibold))                                                TextEditor(text: $viewModel.caption)                            .frame(height: 120)                            .padding(8)                            .background(Color.gray.opacity(0.1))                            .cornerRadius(12)                    }                                        // Error Message                    if !viewModel.errorMessage.isEmpty {                        Text(viewModel.errorMessage)                            .font(.system(size: 14))                            .foregroundColor(.red)                    }                                        Spacer()                }                .padding()            }            .navigationTitle("New Post")            .navigationBarTitleDisplayMode(.inline)            .toolbar {                ToolbarItem(placement: .navigationBarLeading) {                    Button("Cancel") {                        dismiss()                    }                }                                ToolbarItem(placement: .navigationBarTrailing) {                    Button("Post") {                        viewModel.createPost()                    }                    .disabled(viewModel.selectedImage == nil || viewModel.isPosting)                }            }            .sheet(isPresented: $viewModel.showImagePicker) {                ImagePicker(image: $viewModel.selectedImage)            }            .onChange(of: viewModel.postCreated) {                if viewModel.postCreated {                    dismiss()                }            }        }    }}class CreatePostViewModel: ObservableObject {    @Published var selectedImage: UIImage?    @Published var caption = ""    @Published var showImagePicker = false    @Published var isPosting = false    @Published var errorMessage = ""    @Published var postCreated = false        func createPost() {        guard let image = selectedImage else {            errorMessage = "Please select an image"            return        }                isPosting = true        errorMessage = ""                Task {            do {                _ = try await SocialService.shared.createPost(image: image, caption: caption)                await MainActor.run {                    isPosting = false                    postCreated = true                }            } catch {                await MainActor.run {                    isPosting = false                    errorMessage = "Failed to create post: \(error.localizedDescription)"                    print("Error creating post: \(error)")                }            }        }    }}// Image Pickerstruct ImagePicker: UIViewControllerRepresentable {    @Binding var image: UIImage?    @Environment(\.dismiss) var dismiss        func makeUIViewController(context: Context) -> PHPickerViewController {        var config = PHPickerConfiguration()        config.filter = .images        config.selectionLimit = 1                let picker = PHPickerViewController(configuration: config)        picker.delegate = context.coordinator        return picker    }        func updateUIViewController(_ uiViewController: PHPickerViewController, context: Context) {}        func makeCoordinator() -> Coordinator {        Coordinator(self)    }        class Coordinator: NSObject, PHPickerViewControllerDelegate {        let parent: ImagePicker                init(_ parent: ImagePicker) {            self.parent = parent        }                func picker(_ picker: PHPickerViewController, didFinishPicking results: [PHPickerResult]) {            parent.dismiss()                        guard let provider = results.first?.itemProvider else { return }                        if provider.canLoadObject(ofClass: UIImage.self) {                provider.loadObject(ofClass: UIImage.self) { image, _ in                    DispatchQueue.main.async {                        self.parent.image = image as? UIImage                    }                }            }        }    }}#Preview {    CreatePostView()}