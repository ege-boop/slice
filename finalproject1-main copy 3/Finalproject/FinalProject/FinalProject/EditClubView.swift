//
//  EditClubView.swift
//  FinalProject
//
//  Created by Ahmet Aytac on 11/10/25.
//


import SwiftUIstruct EditClubView: View {    let club: Club    @Environment(\.dismiss) var dismiss    @StateObject private var viewModel: EditClubViewModel        init(club: Club) {        self.club = club        _viewModel = StateObject(wrappedValue: EditClubViewModel(club: club))    }        var body: some View {        NavigationView {            ScrollView {                VStack(spacing: 24) {                    // Club Icon                    Circle()                        .fill(Color.black)                        .frame(width: 100, height: 100)                        .overlay(                            Text(viewModel.name.prefix(1).uppercased())                                .font(.system(size: 40, weight: .bold))                                .foregroundColor(.white)                        )                        .padding(.top, 20)                                        // Club Name                    VStack(alignment: .leading, spacing: 8) {                        Text("Club Name")                            .font(.system(size: 14, weight: .semibold))                            .foregroundColor(.gray)                                                TextField("Enter club name", text: $viewModel.name)                            .font(.system(size: 16))                            .padding(14)                            .background(Color.gray.opacity(0.1))                            .cornerRadius(12)                    }                                        // Description                    VStack(alignment: .leading, spacing: 8) {                        Text("Description")                            .font(.system(size: 14, weight: .semibold))                            .foregroundColor(.gray)                                                TextEditor(text: $viewModel.description)                            .frame(height: 120)                            .padding(8)                            .background(Color.gray.opacity(0.1))                            .cornerRadius(12)                    }                                        // Category                    VStack(alignment: .leading, spacing: 8) {                        Text("Category")                            .font(.system(size: 14, weight: .semibold))                            .foregroundColor(.gray)                                                Picker("Category", selection: $viewModel.category) {                            ForEach(ClubCategory.allCases, id: \.self) { category in                                Text(category.rawValue).tag(category.rawValue)                            }                        }                        .pickerStyle(MenuPickerStyle())                        .padding(14)                        .background(Color.gray.opacity(0.1))                        .cornerRadius(12)                    }                                        // Error Message                    if !viewModel.errorMessage.isEmpty {                        Text(viewModel.errorMessage)                            .font(.system(size: 14))                            .foregroundColor(.red)                    }                                        Spacer()                }                .padding()            }            .navigationTitle("Edit Club")            .navigationBarTitleDisplayMode(.inline)            .toolbar {                ToolbarItem(placement: .navigationBarLeading) {                    Button("Cancel") {                        dismiss()                    }                }                                ToolbarItem(placement: .navigationBarTrailing) {                    Button("Save") {                        viewModel.saveChanges {                            dismiss()                        }                    }                    .disabled(viewModel.isSaving)                }            }        }    }}class EditClubViewModel: ObservableObject {    let club: Club    @Published var name: String    @Published var description: String    @Published var category: String    @Published var isSaving = false    @Published var errorMessage = ""        init(club: Club) {        self.club = club        self.name = club.name ?? ""        self.description = club.description ?? ""        self.category = club.category ?? "Social"    }        func saveChanges(completion: @escaping () -> Void) {        guard let clubId = club.objectId else {            errorMessage = "Invalid club"            return        }                guard !name.isEmpty else {            errorMessage = "Club name cannot be empty"            return        }                isSaving = true        errorMessage = ""                Task {            do {                try await ParseService.shared.updateClub(                    clubId: clubId,                    name: name,                    description: description.isEmpty ? nil : description,                    category: category                )                                await MainActor.run {                    isSaving = false                    completion()                }            } catch {                await MainActor.run {                    isSaving = false                    errorMessage = error.localizedDescription                    print("Error updating club: \(error)")                }            }        }    }}#Preview {    EditClubView(club: Club())}