//
//  EventAttendeesView.swift
//  FinalProject
//
//  Created by Ahmet Aytac on 11/16/25.
//


////  EventAttendeesView.swift//  FinalProject////  View all event attendees//import SwiftUIstruct EventAttendeesView: View {    let event: Event    @Environment(\.dismiss) var dismiss    @StateObject private var viewModel: EventAttendeesViewModel    @State private var selectedFilter: AttendeeFilter = .going        enum AttendeeFilter: String, CaseIterable {        case going = "Going"        case interested = "Interested"        case all = "All"    }        init(event: Event) {        self.event = event        _viewModel = StateObject(wrappedValue: EventAttendeesViewModel(event: event))    }        var body: some View {        NavigationView {            VStack(spacing: 0) {                // Filter Buttons                Picker("Filter", selection: $selectedFilter) {                    ForEach(AttendeeFilter.allCases, id: \.self) { filter in                        Text(filter.rawValue).tag(filter)                    }                }                .pickerStyle(SegmentedPickerStyle())                .padding()                                Divider()                                // Attendees List                if viewModel.isLoading {                    ProgressView()                        .padding(.top, 40)                    Spacer()                } else {                    let filteredAttendees = getFilteredAttendees()                                        if filteredAttendees.isEmpty {                        VStack(spacing: 16) {                            Image(systemName: "person.slash")                                .font(.system(size: 50))                                .foregroundColor(.gray)                            Text("No attendees yet")                                .foregroundColor(.gray)                        }                        .padding(.top, 60)                        Spacer()                    } else {                        ScrollView {                            LazyVStack(spacing: 0) {                                ForEach(filteredAttendees, id: \.objectId) { attendee in                                    NavigationLink(destination: UserProfileView(user: attendee)) {                                        AttendeeRow(user: attendee)                                    }                                    .buttonStyle(PlainButtonStyle())                                    Divider().padding(.leading, 80)                                }                            }                        }                    }                }            }            .navigationTitle("Attendees")            .navigationBarTitleDisplayMode(.inline)            .toolbar {                ToolbarItem(placement: .navigationBarTrailing) {                    Button("Done") {                        dismiss()                    }                }            }        }        .onAppear {            viewModel.loadAttendees()        }    }        func getFilteredAttendees() -> [User] {        switch selectedFilter {        case .going:            return viewModel.goingAttendees        case .interested:            return viewModel.interestedAttendees        case .all:            return viewModel.goingAttendees + viewModel.interestedAttendees        }    }}struct AttendeeRow: View {    let user: User        var body: some View {        HStack(spacing: 16) {            Circle()                .fill(Color.black)                .frame(width: 56, height: 56)                .overlay(                    Text(user.username?.prefix(1).uppercased() ?? "?")                        .font(.system(size: 24, weight: .bold))                        .foregroundColor(.white)                )                        VStack(alignment: .leading, spacing: 4) {                Text(user.username ?? "Unknown")                    .font(.system(size: 16, weight: .semibold))                    .foregroundColor(.black)                                if let bio = user.bio, !bio.isEmpty {                    Text(bio)                        .font(.system(size: 14))                        .foregroundColor(.gray)                        .lineLimit(1)                }                                HStack(spacing: 12) {                    Text("\(user.followersCount ?? 0) followers")                        .font(.system(size: 12))                        .foregroundColor(.gray)                }            }                        Spacer()                        Image(systemName: "chevron.right")                .foregroundColor(.gray)        }        .padding()    }}class EventAttendeesViewModel: ObservableObject {    let event: Event    @Published var goingAttendees: [User] = []    @Published var interestedAttendees: [User] = []    @Published var isLoading = false        init(event: Event) {        self.event = event    }        func loadAttendees() {        guard let eventId = event.objectId else { return }                isLoading = true                Task {            do {                async let going = EventService.shared.getEventAttendees(eventId: eventId, status: .going)                async let interested = EventService.shared.getEventAttendees(eventId: eventId, status: .interested)                                let (goingList, interestedList) = try await (going, interested)                                await MainActor.run {                    self.goingAttendees = goingList                    self.interestedAttendees = interestedList                    self.isLoading = false                }            } catch {                await MainActor.run {                    self.isLoading = false                    print("Error loading attendees: \(error)")                }            }        }    }}#Preview {    EventAttendeesView(event: Event())}