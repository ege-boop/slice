import SwiftUIimport ParseSwiftstruct HomeView: View {    @StateObject private var viewModel = HomeViewModel()    @State private var showCreatePost = false        var body: some View {        NavigationView {            ScrollView {                LazyVStack(spacing: 0) {                    if let user = User.current {                        HStack {                            VStack(alignment: .leading, spacing: 4) {                                Text("Welcome back,")                                    .font(.system(size: 14))                                    .foregroundColor(.gray)                                Text(user.username ?? "User")                                    .font(.system(size: 24, weight: .bold))                            }                                                        Spacer()                                                        Button(action: {                                showCreatePost = true                            }) {                                Image(systemName: "plus.circle.fill")                                    .font(.system(size: 28))                                    .foregroundColor(.black)                            }                        }                        .padding()                    }                                        Divider()                                        if viewModel.isLoading {                        ProgressView()                            .padding(.top, 50)                    } else if viewModel.posts.isEmpty {                        VStack(spacing: 20) {                            Image(systemName: "photo.on.rectangle.angled")                                .font(.system(size: 60))                                .foregroundColor(.gray)                                                        Text("No posts yet")                                .font(.system(size: 20, weight: .semibold))                                                        Button("Create Your First Post") {                                showCreatePost = true                            }                            .padding()                            .background(Color.black)                            .foregroundColor(.white)                            .cornerRadius(10)                        }                        .padding(.top, 80)                    } else {                        ForEach(viewModel.posts) { post in                            PostCard(                                post: post,                                onLike: { viewModel.toggleLike(post: post) },                                onComment: { viewModel.selectedPost = post }                            )                        }                    }                }            }            .navigationTitle("Feed")            .refreshable {                viewModel.loadPosts()            }            .sheet(isPresented: $showCreatePost) {                CreatePostView()            }            .sheet(item: $viewModel.selectedPost) { post in                CommentsView(post: post)            }        }        .onAppear {            viewModel.loadPosts()        }    }}struct PostCard: View {    let post: Post    let onLike: () -> Void    let onComment: () -> Void        @State private var isLiked = false    @State private var likeCount: Int        init(post: Post, onLike: @escaping () -> Void, onComment: @escaping () -> Void) {        self.post = post        self.onLike = onLike        self.onComment = onComment        _likeCount = State(initialValue: post.likesCount ?? 0)    }        var body: some View {        VStack(alignment: .leading, spacing: 0) {            HStack(spacing: 12) {                NavigationLink(destination: UserProfileViewFromPost(userId: post.userId ?? "")) {                    Circle()                        .fill(Color.black)                        .frame(width: 40, height: 40)                        .overlay(                            Text(post.username?.prefix(1).uppercased() ?? "?")                                .font(.system(size: 16, weight: .bold))                                .foregroundColor(.white)                        )                }                                VStack(alignment: .leading, spacing: 2) {                    NavigationLink(destination: UserProfileViewFromPost(userId: post.userId ?? "")) {                        Text(post.username ?? "Unknown")                            .font(.system(size: 15, weight: .semibold))                            .foregroundColor(.black)                    }                                        if let time = post.createdAt {                        Text(timeAgo(from: time))                            .font(.system(size: 12))                            .foregroundColor(.gray)                    }                }                                Spacer()                                Button(action: {}) {                    Image(systemName: "ellipsis")                        .foregroundColor(.black)                }            }            .padding()                        if let imageURL = post.imageURL, let url = URL(string: imageURL) {                AsyncImage(url: url) { phase in                    switch phase {                    case .empty:                        Rectangle()                            .fill(Color.gray.opacity(0.2))                            .frame(height: 300)                            .overlay(                                ProgressView()                            )                    case .success(let image):                        image                            .resizable()                            .scaledToFit()                            .frame(maxHeight: 400)                    case .failure:                        Rectangle()                            .fill(Color.gray.opacity(0.2))                            .frame(height: 300)                            .overlay(                                Image(systemName: "photo")                                    .font(.system(size: 50))                                    .foregroundColor(.gray)                            )                    @unknown default:                        EmptyView()                    }                }            } else {                Rectangle()                    .fill(LinearGradient(                        colors: [Color.black.opacity(0.8), Color.gray.opacity(0.6)],                        startPoint: .topLeading,                        endPoint: .bottomTrailing                    ))                    .frame(height: 300)            }                        HStack(spacing: 16) {                Button(action: {                    isLiked.toggle()                    likeCount += isLiked ? 1 : -1                    onLike()                }) {                    Image(systemName: isLiked ? "heart.fill" : "heart")                        .font(.system(size: 24))                        .foregroundColor(isLiked ? .red : .black)                }                                Button(action: onComment) {                    Image(systemName: "bubble.right")                        .font(.system(size: 24))                        .foregroundColor(.black)                }                                Button(action: {}) {                    Image(systemName: "paperplane")                        .font(.system(size: 24))                        .foregroundColor(.black)                }                                Spacer()                                Button(action: {}) {                    Image(systemName: "bookmark")                        .font(.system(size: 24))                        .foregroundColor(.black)                }            }            .padding(.horizontal)            .padding(.vertical, 12)                        if likeCount > 0 {                Text("\(likeCount) likes")                    .font(.system(size: 14, weight: .semibold))                    .padding(.horizontal)                    .padding(.bottom, 4)            }                        if let caption = post.caption, !caption.isEmpty {                HStack(alignment: .top, spacing: 4) {                    NavigationLink(destination: UserProfileViewFromPost(userId: post.userId ?? "")) {                        Text(post.username ?? "")                            .font(.system(size: 14, weight: .semibold))                            .foregroundColor(.black)                    }                    Text(caption)                        .font(.system(size: 14))                }                .padding(.horizontal)                .padding(.bottom, 8)            }                        if let commentsCount = post.commentsCount, commentsCount > 0 {                Button(action: onComment) {                    Text("View all \(commentsCount) comments")                        .font(.system(size: 14))                        .foregroundColor(.gray)                }                .padding(.horizontal)                .padding(.bottom, 8)            }                        Divider()                .padding(.top, 8)        }    }        func timeAgo(from date: Date) -> String {        let seconds = Date().timeIntervalSince(date)                if seconds < 60 {            return "Just now"        } else if seconds < 3600 {            let minutes = Int(seconds / 60)            return "\(minutes)m ago"        } else if seconds < 86400 {            let hours = Int(seconds / 3600)            return "\(hours)h ago"        } else {            let days = Int(seconds / 86400)            return "\(days)d ago"        }    }}struct UserProfileViewFromPost: View {    let userId: String    @State private var user: User?    @State private var isLoading = true        var body: some View {        Group {            if isLoading {                VStack {                    ProgressView()                    Spacer()                }            } else if let user = user {                UserProfileView(user: user)            } else {                VStack {                    Text("User not found")                        .foregroundColor(.gray)                    Spacer()                }            }        }        .onAppear {            loadUser()        }    }        func loadUser() {        Task {            do {                let query = User.query()                let allUsers = try await query.find()                                if let foundUser = allUsers.first(where: { $0.objectId == userId }) {                    await MainActor.run {                        self.user = foundUser                        self.isLoading = false                    }                } else {                    await MainActor.run {                        self.isLoading = false                    }                }            } catch {                await MainActor.run {                    self.isLoading = false                    print("Error loading user: \(error)")                }            }        }    }}class HomeViewModel: ObservableObject {    @Published var posts: [Post] = []    @Published var isLoading = false    @Published var selectedPost: Post?        func loadPosts() {        isLoading = true                Task {            do {                let fetchedPosts = try await SocialService.shared.getFeed()                await MainActor.run {                    self.posts = fetchedPosts                    self.isLoading = false                }            } catch {                await MainActor.run {                    self.isLoading = false                    print("Error loading posts: \(error)")                }            }        }    }        func toggleLike(post: Post) {        guard let postId = post.objectId else { return }                Task {            do {                let userId = User.current?.objectId ?? ""                let isLiked = try await SocialService.shared.checkIfLiked(postId: postId, userId: userId)                                if isLiked {                    try await SocialService.shared.unlikePost(postId: postId)                } else {                    try await SocialService.shared.likePost(postId: postId)                }                                loadPosts()            } catch {                print("Error toggling like: \(error)")            }        }    }}#Preview {    HomeView()}