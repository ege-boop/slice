////  SearchView.swift//  FinalProject//import SwiftUIimport ParseSwiftstruct SearchView: View {    @StateObject private var viewModel = SearchViewModel()    @State private var searchText = ""        var body: some View {        NavigationView {            VStack(spacing: 0) {                HStack {                    Image(systemName: "magnifyingglass")                        .foregroundColor(.gray)                                        TextField("Search users...", text: $searchText)                        .autocapitalization(.none)                        .onChange(of: searchText) { newValue in                            viewModel.searchUsers(query: newValue)                        }                                        if !searchText.isEmpty {                        Button(action: {                            searchText = ""                            viewModel.searchResults = []                        }) {                            Image(systemName: "xmark.circle.fill")                                .foregroundColor(.gray)                        }                    }                }                .padding()                .background(Color.gray.opacity(0.1))                .cornerRadius(12)                .padding()                                Divider()                                if searchText.isEmpty {                    VStack(spacing: 20) {                        Image(systemName: "person.2.fill")                            .font(.system(size: 60))                            .foregroundColor(.gray)                                                Text("Search for users")                            .font(.system(size: 18, weight: .semibold))                                                Text("Find people by their username")                            .font(.system(size: 14))                            .foregroundColor(.gray)                    }                    .padding(.top, 80)                                        Spacer()                } else if viewModel.isSearching {                    ProgressView()                        .padding(.top, 40)                    Spacer()                } else if viewModel.searchResults.isEmpty {                    VStack(spacing: 20) {                        Image(systemName: "person.crop.circle.badge.questionmark")                            .font(.system(size: 60))                            .foregroundColor(.gray)                                                Text("No users found")                            .font(.system(size: 18, weight: .semibold))                                                Text("Try searching for '\(searchText)'")                            .font(.system(size: 14))                            .foregroundColor(.gray)                    }                    .padding(.top, 80)                                        Spacer()                } else {                    ScrollView {                        LazyVStack(spacing: 0) {                            ForEach(viewModel.searchResults, id: \.objectId) { user in                                NavigationLink(destination: UserProfileView(user: user)) {                                    UserSearchRow(user: user)                                }                                .buttonStyle(PlainButtonStyle())                                                                Divider()                                    .padding(.leading, 80)                            }                        }                    }                }            }            .navigationTitle("Search")        }    }}struct UserSearchRow: View {    let user: User        var body: some View {        HStack(spacing: 16) {            Circle()                .fill(Color.black)                .frame(width: 56, height: 56)                .overlay(                    Text(user.username?.prefix(1).uppercased() ?? "U")                        .font(.system(size: 24, weight: .bold))                        .foregroundColor(.white)                )                        VStack(alignment: .leading, spacing: 4) {                HStack(spacing: 6) {                    Text(user.displayName ?? user.username ?? "User")                        .font(.system(size: 16, weight: .semibold))                        .foregroundColor(.black)                                        if user.isVerified == true {                        Image(systemName: "checkmark.seal.fill")                            .foregroundColor(.blue)                            .font(.system(size: 14))                    }                }                                Text("@\(user.username ?? "user")")                    .font(.system(size: 14))                    .foregroundColor(.gray)                                if let bio = user.bio, !bio.isEmpty {                    Text(bio)                        .font(.system(size: 13))                        .foregroundColor(.gray)                        .lineLimit(1)                }            }                        Spacer()                        Image(systemName: "chevron.right")                .foregroundColor(.gray)                .font(.system(size: 14))        }        .padding()    }}class SearchViewModel: ObservableObject {    @Published var searchResults: [User] = []    @Published var isSearching = false        private var searchTask: Task<Void, Never>?        func searchUsers(query: String) {        searchTask?.cancel()                guard !query.isEmpty else {            searchResults = []            return        }                guard let currentUserId = User.current?.objectId else {            print("‚ùå No current user")            return        }                isSearching = true                print("üîç Searching for: '\(query)'")                searchTask = Task {            do {                try await Task.sleep(nanoseconds: 300_000_000)                                guard !Task.isCancelled else { return }                                let results = try await SocialService.shared.searchUsers(query: query)                                let filteredResults = results.filter { $0.objectId != currentUserId }                                await MainActor.run {                    self.searchResults = filteredResults                    self.isSearching = false                    print("‚úÖ Found \(filteredResults.count) users")                    print("üì± Showing \(filteredResults.count) users (excluding current user)")                }            } catch {                await MainActor.run {                    self.isSearching = false                    print("‚ùå Search error: \(error)")                }            }        }    }}#Preview {    SearchView()}