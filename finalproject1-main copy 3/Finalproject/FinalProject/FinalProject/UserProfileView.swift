////  UserProfileView.swift//  FinalProject//import SwiftUIstruct UserProfileView: View {    let user: User    @StateObject private var viewModel: UserProfileViewModel    @State private var showDMSheet = false    @Environment(\.dismiss) var dismiss        init(user: User) {        self.user = user        _viewModel = StateObject(wrappedValue: UserProfileViewModel(user: user))    }        var body: some View {        ScrollView {            VStack(spacing: 24) {                VStack(spacing: 16) {                    Circle()                        .fill(Color.black)                        .frame(width: 100, height: 100)                        .overlay(                            Text(user.username?.prefix(1).uppercased() ?? "?")                                .font(.system(size: 40, weight: .bold))                                .foregroundColor(.white)                        )                                        VStack(spacing: 8) {                        HStack(spacing: 6) {                            Text(user.displayName ?? user.username ?? "User")                                .font(.system(size: 24, weight: .bold))                                                        if user.isVerified == true {                                Image(systemName: "checkmark.seal.fill")                                    .foregroundColor(.blue)                                    .font(.system(size: 20))                            }                        }                                                Text("@\(user.username ?? "user")")                            .font(.system(size: 16))                            .foregroundColor(.gray)                    }                                        if let bio = user.bio, !bio.isEmpty {                        Text(bio)                            .font(.system(size: 14))                            .foregroundColor(.gray)                            .multilineTextAlignment(.center)                            .padding(.horizontal, 40)                    }                }                .padding(.top, 20)                                HStack(spacing: 0) {                    StatColumn(                        value: "\(user.postsCount ?? 0)",                        label: "Posts"                    )                                        Divider()                        .frame(height: 40)                                        StatColumn(                        value: "\(user.followersCount ?? 0)",                        label: "Followers"                    )                                        Divider()                        .frame(height: 40)                                        StatColumn(                        value: "\(user.followingCount ?? 0)",                        label: "Following"                    )                }                .padding()                .background(Color.gray.opacity(0.1))                .cornerRadius(12)                .padding(.horizontal)                                HStack(spacing: 12) {                    Button(action: {                        showDMSheet = true                    }) {                        HStack {                            Image(systemName: "envelope.fill")                            Text("Message")                        }                        .font(.system(size: 16, weight: .semibold))                        .foregroundColor(.white)                        .frame(maxWidth: .infinity)                        .padding(.vertical, 14)                        .background(Color.black)                        .cornerRadius(12)                    }                                        if viewModel.isFollowing {                        Button(action: {                            viewModel.unfollowUser()                        }) {                            if viewModel.isLoading {                                ProgressView()                                    .progressViewStyle(CircularProgressViewStyle(tint: .black))                            } else {                                HStack {                                    Image(systemName: "person.badge.minus")                                    Text("Unfollow")                                }                                .font(.system(size: 16, weight: .semibold))                                .foregroundColor(.black)                            }                        }                        .frame(maxWidth: .infinity)                        .padding(.vertical, 14)                        .background(Color.gray.opacity(0.2))                        .cornerRadius(12)                        .disabled(viewModel.isLoading)                    } else {                        Button(action: {                            viewModel.followUser()                        }) {                            if viewModel.isLoading {                                ProgressView()                                    .progressViewStyle(CircularProgressViewStyle(tint: .white))                            } else {                                HStack {                                    Image(systemName: "person.badge.plus")                                    Text("Follow")                                }                                .font(.system(size: 16, weight: .semibold))                                .foregroundColor(.white)                            }                        }                        .frame(maxWidth: .infinity)                        .padding(.vertical, 14)                        .background(Color.black)                        .cornerRadius(12)                        .disabled(viewModel.isLoading)                    }                }                .padding(.horizontal)                                Divider()                                if viewModel.posts.isEmpty {                    VStack(spacing: 16) {                        Image(systemName: "photo.on.rectangle")                            .font(.system(size: 50))                            .foregroundColor(.gray)                        Text("No posts yet")                            .font(.system(size: 16))                            .foregroundColor(.gray)                    }                    .padding(.top, 40)                } else {                    LazyVGrid(columns: [                        GridItem(.flexible()),                        GridItem(.flexible()),                        GridItem(.flexible())                    ], spacing: 2) {                        ForEach(viewModel.posts) { post in                            if let imageURL = post.imageURL, let url = URL(string: imageURL) {                                AsyncImage(url: url) { phase in                                    switch phase {                                    case .empty:                                        Rectangle()                                            .fill(Color.gray.opacity(0.2))                                            .aspectRatio(1, contentMode: .fit)                                            .overlay(ProgressView())                                    case .success(let image):                                        image                                            .resizable()                                            .scaledToFill()                                            .aspectRatio(1, contentMode: .fill)                                            .clipped()                                    case .failure:                                        Rectangle()                                            .fill(Color.gray.opacity(0.2))                                            .aspectRatio(1, contentMode: .fit)                                    @unknown default:                                        EmptyView()                                    }                                }                            }                        }                    }                }            }        }        .navigationBarTitleDisplayMode(.inline)        .sheet(isPresented: $showDMSheet) {            DMChatView(otherUser: user)        }        .onAppear {            viewModel.loadData()        }    }}struct DMChatView: View {    let otherUser: User    @Environment(\.dismiss) var dismiss    @State private var messageText = ""        var body: some View {        NavigationView {            VStack(spacing: 0) {                ScrollView {                    VStack(spacing: 20) {                        Image(systemName: "bubble.left.and.bubble.right")                            .font(.system(size: 50))                            .foregroundColor(.gray)                                                Text("Start a conversation")                            .font(.system(size: 18, weight: .semibold))                                                Text("Send a message to @\(otherUser.username ?? "user")")                            .font(.system(size: 14))                            .foregroundColor(.gray)                            .multilineTextAlignment(.center)                            .padding(.horizontal, 40)                    }                    .padding(.top, 100)                }                                Divider()                                HStack(spacing: 12) {                    TextField("Type a message...", text: $messageText)                        .textFieldStyle(PlainTextFieldStyle())                        .padding(12)                        .background(Color.gray.opacity(0.1))                        .cornerRadius(20)                                        Button(action: {                        print("Send DM: \(messageText)")                        messageText = ""                    }) {                        Image(systemName: "arrow.up.circle.fill")                            .font(.system(size: 32))                            .foregroundColor(messageText.isEmpty ? .gray : .black)                    }                    .disabled(messageText.isEmpty)                }                .padding()            }            .navigationTitle("@\(otherUser.username ?? "User")")            .navigationBarTitleDisplayMode(.inline)            .toolbar {                ToolbarItem(placement: .navigationBarTrailing) {                    Button("Done") {                        dismiss()                    }                }            }        }    }}class UserProfileViewModel: ObservableObject {    let user: User    @Published var posts: [Post] = []    @Published var isFollowing = false    @Published var isLoading = false        init(user: User) {        self.user = user    }        func loadData() {        guard let userId = user.objectId else { return }                Task {            do {                let userPosts = try await SocialService.shared.getUserPosts(userId: userId)                await MainActor.run {                    self.posts = userPosts                }            } catch {                print("Error loading user posts: \(error)")            }        }                Task {            do {                let following = try await SocialService.shared.checkIfFollowing(userId: userId)                await MainActor.run {                    self.isFollowing = following                }            } catch {                print("Error checking follow status: \(error)")            }        }    }        func followUser() {        guard let userId = user.objectId else { return }                isLoading = true                Task {            do {                try await SocialService.shared.followUser(userId: userId)                await MainActor.run {                    self.isFollowing = true                    self.isLoading = false                }            } catch {                await MainActor.run {                    self.isLoading = false                    print("Error following user: \(error)")                }            }        }    }        func unfollowUser() {        guard let userId = user.objectId else { return }                isLoading = true                Task {            do {                try await SocialService.shared.unfollowUser(userId: userId)                await MainActor.run {                    self.isFollowing = false                    self.isLoading = false                }            } catch {                await MainActor.run {                    self.isLoading = false                    print("Error unfollowing user: \(error)")                }            }        }    }}#Preview {    NavigationView {        UserProfileView(user: User())    }}